# pocket-battle-sim

Backend todo:

- [x] Parse cards
  - [x] A1: 237/237 (100%)
  - [x] A1a: 70/70 (100%)
  - [x] A2: 157/157 (100%)
  - [x] A2a: 77/77 (100%)
  - [x] A2b: 73/73 (100%)
  - [x] A3: 157/157 (100%)
  - [x] A3a: 72/72 (100%)
  - [ ] A3b: 63/71 (88.7%)
    - [ ] New triggers
      - [x] When played to evolve
      - [ ] At end of your turn
    - [ ] New conditionals
      - [x] Specific Attack was used during your last turn
      - [ ] Self evolved during this turn
    - [ ] New damage modifiers
      - [ ] Extra damage per Energy attached to self
      - [x] Extra damage per Energy attached to all of opponent's mon
      - [x] Damage per times attack used by your mon during current game
    - [ ] New attacking effects
      - [ ] Damage to each of your Benched mon
    - [ ] New side effects
      - [ ] Discard all Tools from opponent's Active mon
      - [ ] Look at random Supporter from opponent's deck and use its effect
    - [x] New statuses
      - [x] CanEvolveAs(name)
    - [x] New Pokémon predicates
      - [x] Pokémon that evolves from [name]
      - [x] Evolution Pokémon
    - [x] Other new parsing
      - [x] "Choose 1: [effect A] [effect B]"
    - [ ] Parsing modifications
      - [x] "Attach _a_ {X} Energy from your discard pile to _this_ Pokémon."
      - [x] "Discard all Energy _attached to_ this Pokémon."
      - [x] "This attack does 30 more damage for each _[predicate] on your Bench_."
      - [ ] Attack-copying effect should consume conditional if available
      - [x] "If _the Defending Pokémon_ is a [predicate],"
      - [x] "_it_ can't attack."
      - [x] "Heal N damage from _it_."
      - [x] "Heal N damage from _that Pokémon_."
    - [x] Unique Promo cards
      - [x] Dragonair
      - [x] Audino
  - [ ] A4
    - [ ] Baby Pokémon (0-cost attacks)
  - [ ] A4a
- [ ] Bring in newer sets
  - [x] A2-A4a
  - [ ] A4b-B1a
- [ ] Game logic improvements
  - [x] Combine statuses that increase and decrease the same stat
    - [x] ModifyAttackDamage/IncreaseAttack
  - [ ] Implement max Energy and HP/damage limits
  - [x] Possibly rework how Tools that apply statuses work?
    - [x] Current bug: Eevee with Leaf Cape evolving into Leafeon will not gain HP
  - [ ] Some properties on `PlayerPokemonView` can be maliciously modified by agents—use `.slice()` and make deep copies
  - [x] Parsing logic is duplicated across different parsing files; there's probably a way to combine all the natural language parsing into one method
  - [ ] A lot of the reactive logic that I'm currently hard-coding could possibly be simplified by switching everything to Vue's `ref`/`computed`/`watch`
    - Biggest downside I see with this approach is maintaining order-of-operations (OOO) becomes much trickier to keep track of (for example, every action _must_ be logged before the relevant property is modified)
    - Callbacks still feel like a better approach for things like knockouts which happen out of sequence with the property they're related to (can't just do `watch(hp, (val) => { if (val == 0) ... })`)
    - I also don't know if this will be faster or slower than the callback approach, but I would guess slower at first glance
- [ ] Logging improvements
  - [ ] Add increase/decrease max HP log events (probably does not need to be separate)
  - [ ] If damage prevention came from somewhere other than the afflicted mon, log it (e.g. Comfey)
  - [ ] Log the specific Special Condition prevented instead of just "a Special Condition"
  - [ ] Prevent "played to bench" event from appearing as a player action when it was a side effect
- [ ] Interactions to test in-app
  - [ ] Heavy Helmet vs CounterAttack status effect (does it reduce damage? Reddit claims it will)
  - [ ] Heavy Helmet vs max HP damage (990 or 970?)
- [x] Single battle simulation
- [ ] Basic logic-based AI opponent (at least as competitive as Auto Mode)
  - [ ] Evolve multiple mon per turn
  - [ ] Avoid putting down multiple of the same mon if others are available
  - [x] Properly calculate energy costs for attacking
  - [ ] Why is the bot not switching into mon that are ready to attack?
- [x] Mass battle simulation
- [ ] Deck fine-tuning via iteration

Frontend todo:

- [x] Battle simulation UI (~90%)
  - [ ] Collapse energy icons when at 5 or more
  - [ ] Display game points somewhere
  - [x] Display discard somewhere
  - [x] Display deck size and opponent hand size
  - [x] Display attached Pokemon Tools
  - [ ] Display statuses and Special Conditions
  - [ ] Concede/quit button
  - [ ] Auto mode toggle? (Will need to adjust BetterRandomAgent to be able to stop and start in the middle of a turn)
- [x] Allow user to select decks for arena
- [x] Allow user control of one or both players in arena
  - [x] Control selectNPokemon()
  - [ ] Control distributeEnergy()
- [ ] Allow user to select set of decks to run in mass simulator
- [x] Deck list UI
  - [x] Custom and built-in decks
  - [x] Show cards and energy types in deck
- [x] Deck builder UI
  - [x] Display cards currently in deck
  - [x] Display count on card and allow +/-/x
  - [x] Allow energy selection
  - [x] Add ability to save decks and edit existing decks
  - [x] Advanced search filters
